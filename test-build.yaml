 trigger:
 - main

 pool:
   vmImage: 'ubuntu-latest' 

 variables:
   imageName: 'barichello/godot-ci'

 steps:
 - task: Docker@2
   displayName: Build an image
   inputs:
     repository: $(imageName)
     command: build
     Dockerfile: ./DOCKERFILE

 - script: |
    docker godot --headless --verbose --editor --quit
    docker mkdir -v -p build/windows
    docker godot --headless --verbose --export-release "Windows Desktop" ../build/windows/Sunfall.exe

 - task: PublishBuildArtifacts@1
   inputs:
     PathtoPublish: '$(Build.ArtifactStagingDirectory)'
     ArtifactName: 'drop'
     publishLocation: 'Container'    